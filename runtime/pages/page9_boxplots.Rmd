### Options

```{r}
selectizeInput("plotVar", "Variable", choices = NULL, selected = NULL, multiple = FALSE)
#selectizeInput("plotMetric", "Metric", choices = varMetrics, selected = varMetrics[1], multiple = FALSE)
selectizeInput("varCategory", "Category", choices = categoriesExtraInputs, selected = "VFD", multiple = TRUE)
selectizeInput("colorCategory", "Color", choices = categoriesExtraInputs, selected = "None", multiple = FALSE)
selectizeInput("shapeCategory", "Shape", choices = categoriesExtraInputs, selected = "None", multiple = FALSE)
checkboxInput("doPaired", "Make it a paired plot",value=FALSE)
selectizeInput("pairedCategory", "Paired Category", choices = categoriesExtraInputs, selected = "None", multiple = FALSE)
```

Column
--------------------------------------------

### Step Variability Plot  {data-height=2500}
Generate boxplots of the selected data that are split up according to different categories.
```{r}
imageOutput("var")
```

```{r, context="server"}
# Update variable choices dynamically based on the actual data
observe({
  mu <- get_mu_dyn_long()
  if (!is.null(mu) && nrow(mu) > 0) {
    vars <- colnames(mu)
    # Set a good default if available
    default_var <- if ("stepWidths.sd" %in% vars) "stepWidths.sd" else
                   if ("task_max_q" %in% vars) "task_max_q" else vars[1]

    current <- isolate(input$plotVar)
    selected <- if (!is.null(current) && current %in% vars) current else default_var

    updateSelectizeInput(session, "plotVar",
                        choices = vars,
                        selected = selected)
  }
})

output$var <- renderSVG({ reactive({
    mu <- get_mu_dyn_long()
    if (!input$doPaired) {
      plot_boxplots(mu, input$plotVar, input$varCategory, input$colorCategory, input$shapeCategory, input$baseSize)
    }
    else {
      plot_paired(mu, input$plotVar, input$pairedCategory, input$varCategory, input$colorCategory, input$shapeCategory, input$baseSize)
    }
  })
})
```
