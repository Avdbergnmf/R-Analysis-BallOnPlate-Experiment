### Plot Options
```{r}
# Create page-specific logger (logging system already loaded globally)
page_logger <- create_module_logger("PAGE2-REMOVED-STEPS")
page_logger("DEBUG", "Initializing removed steps page options")

checkboxInput("useFiltered", "Filter data",
  value = FALSE
)

selectizeInput("groupStatsCategory", "Category", choices = categoriesExtra, selected = "participant", multiple = TRUE)
page_logger("DEBUG", "Removed steps page options initialized")
```

Column
--------------------------------------------


### Removed Steps {data-height=600}
Gives a quick overview of how many steps have been removed and why, used for reporting in the paper. If the filter data checkbox is enabled, the data is filtered based on the selected settings in the sidebar. Note that in the paper we reported this information where we excluded all the steps in the familiarization trials (enable the filter checkbox, add outlier and suspect steps in the sidebar, but make sure the familiarization trials are removed).

```{r}
imageOutput("pie")
```

### Step Statistics {data-height=500}

```{r}
tableOutput("step_table")
```

```{r, context="server"}
# Use the page logger already created in the options section
output$pie <- renderSVG({
  reactive({
    page_logger("DEBUG", "Rendering pie chart - filtered:", input$useFiltered)

    if (input$useFiltered) {
      data <- filteredParams()
      page_logger("DEBUG", "Using filtered data for pie chart, rows:", nrow(data))
    } else {
      data <- allGaitParams
      page_logger("DEBUG", "Using all gait parameters for pie chart, rows:", nrow(data))
    }

    page_logger("DEBUG", "Creating pie chart with base size:", input$baseSize)
    return(plotting$make_pie_chart(data, baseSize = input$baseSize))
  })
})

output$step_table <- renderTable(
  {
    page_logger("DEBUG", "Rendering step statistics table - filtered:", input$useFiltered, "categories:", paste(input$groupStatsCategory, collapse = ", "))

    if (input$useFiltered) {
      data <- filteredParams()
      page_logger("DEBUG", "Using filtered data for step statistics, rows:", nrow(data))
    } else {
      data <- allGaitParams
      page_logger("DEBUG", "Using all gait parameters for step statistics, rows:", nrow(data))
    }

    # Gait feature is loaded globally in initialization
    page_logger("DEBUG", "Calculating step statistics with categories:", paste(input$groupStatsCategory, collapse = ", "))
    step_stats <- gait$calculate_step_statistics(data, input$groupStatsCategory)
    page_logger("DEBUG", "Step statistics calculated, dimensions:", nrow(step_stats), "x", ncol(step_stats))

    return(step_stats)
  },
  rownames = TRUE,
  options = list(pageLength = 100, scrollY = "500px")
)
```